all(names(seqdata_filter) == meta$sample_id)
# Calculamos CPM
calccpm = cpm(seqdata_filter)
# Aparamos os dados, removendo genes com baixa expressão
# é geralmente aceite a eliminação de genes com CPM inferior a 0.5 em mais do que 2 amostras
thresh = calccpm > 0.5
keep = rowSums(thresh) >= 2
counts_keep = seqdata_filter[keep,]
summary(keep)
dim(counts_keep)
# Criação do objeto para a análise de expr. diferencial
dgeObj = DGEList(counts_keep)
names(dgeObj)
head(dgeObj$samples)
## distributions - log transform
logcounts = cpm(dgeObj,log=TRUE)
boxplot(logcounts[,1:50], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,51:100], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,101:150], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,151:200], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,201:248], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
# Cálculo da variância de cada gene nos dados de contagem logaritmizada
var_genes = apply(logcounts, 1, var)
# Seleção dos 10 genes com maior variabilidade
select_var = names(sort(var_genes, decreasing=TRUE))[1:10]
head(select_var)
# Seleciona as linhas da matriz 'logcounts' com base nos índices fornecidos em 'select_var'
highly_variable_lcpm = logcounts[select_var,]
# Calcula as dimensões (número de linhas e colunas) da matriz 'highly_variable_lcpm'
dim(highly_variable_lcpm)
mypalette <- brewer.pal(9,"RdYlBu")
morecols <- colorRampPalette(mypalette)
#indices = 1:242
#unique_stages = unique(meta$oncogene[indices])
#cores = length(unique_stages)
#stage_pal = brewer.pal(9,'Set1')
#stage_cols = colorRampPalette(stage_pal)
#col.cell = stage_cols(length(unique_stages))
#col.cell <- stage_cols(cores)[meta$oncogene[indices]]
#col.cell = c("purple","orange", "green")[meta$expr]
#color_mapping <- setNames(col.cell, unique_stages)
#heatmap.2(highly_variable_lcpm[,indices],
#          col=rev(morecols(5)),
#          trace="column",
#          main="Top 10 most variable genes across samples",
#          ColSideColors = col.cell,
#          scale="row"
#          )
#heatmap.2(highly_variable_lcpm,
#          col=rev(morecols(50)),
#          trace="column",
#          main="Top 10 most variable genes across samples",
#          ColSideColors=col.cell,scale="row")
col.cell1 = c("purple","orange", "green")[meta$expr]
heatmap.2(highly_variable_lcpm,
col=rev(morecols(50)),
trace="column",
main="Top 10 most variable genes across samples",
ColSideColors=col.cell1,scale="row")
dgeObj = calcNormFactors(dgeObj)
# demo
plotMD(logcounts, column = 7)
abline(h=0,col="grey")
plotMD(dgeObj, column = 7)
abline(h=0,col="grey")
dgeObj = estimateCommonDisp(dgeObj)
dgeObj$common.dispersion
dgeObj = estimateGLMTrendedDisp(dgeObj)
dgeObj = estimateTagwiseDisp(dgeObj)
plotBCV(dgeObj)
fit = glmFit(dgeObj, design)
head(fit$coefficients)
fit = glmFit(dgeObj, design)
head(fit$coefficients)
lrt.BvsL = glmLRT(fit, coef = 4)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
lrt.BvsL = glmLRT(fit, coef = 1)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
lrt.BvsL = glmLRT(fit, coef = 4)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
PvsV <- makeContrasts(genderfemale-gendermale, levels=design)
# Renomear os níveis do fator expr
levels(expr) <- make.names(levels(expr))
PvsV <- makeContrasts(genderfemale-gendermale, levels=design)
# Criar uma cópia do design
design_copy <- design
# Renomear os níveis do fator expr
levels(design_copy$expr) <- make.names(levels(design_copy$expr))
# Corrigir os nomes dos níveis do fator expr
levels(design$expr) <- make.names(levels(design$expr))
# Corrigir os nomes dos níveis do fator expr
levels(design$expr) <- make.names(levels(design$expr))
# Corrigir os nomes dos níveis do fator expr
levels(design$expr) <- make.names(levels(design$expr))
# Definir contraste
PvsV <- makeContrasts(genderfemale - gendermale, levels = design)
# Carregamento de metadados
gender = luad_data$gender
sample_id = substr(luad_data$sample_id, 1, 10)
expr = luad_data$paper_expression_subtype
meta = data.frame(sample_id = sample_id, gender = gender, expr = expr)
View(meta)
# Carregamento de metadados
gender = luad_data$gender
sample_id = substr(luad_data$sample_id, 1, 10)
expr = luad_data$paper_expression_subtype
meta = data.frame(sample_id = sample_id, gender = gender, expr = expr)
# Substituir caracteres especiais nos valores de expr
meta$expr <- gsub("prox.-prolif.", "prox_prolif", meta$expr)
meta$expr <- gsub("prox.-inflam", "prox_inflam", meta$expr)
group = paste(meta$gender, meta$expr, sep = ".")
group = as.character(group)
group
gender = sapply(strsplit(group, ".", fixed=T), function(x) x[1])
gender = factor(gender, levels = c("male", "female"))
expr = sapply(strsplit(group, ".", fixed=T), function(x) x[2])
expr = factor(expr, levels = c("prox_prolif", "prox_inflam", "TRU"))
# Definir a variável de design
design = model.matrix(~ expr + gender)
head(design)
dgeObj = estimateCommonDisp(dgeObj)
dgeObj$common.dispersion
dgeObj = estimateGLMTrendedDisp(dgeObj)
dgeObj = estimateTagwiseDisp(dgeObj)
plotBCV(dgeObj)
# Definir contraste
PvsV <- makeContrasts(genderfemale - gendermale, levels = design)
# Definir contraste
PvsV <- makeContrasts(genderfemale-gendermale, levels = design)
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam-exprTRU, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
# Tamanho do objeto
dim(luad_data)
# Informação sobre o estudo
metadata(luad_data)
# Informação sobre os tipos de dados de RNASeq
names(assays(luad_data))
# Tipos de metadados associados a cada gene
names(rowData(luad_data))
# Tipos de metadados associados a cada amostra
names(colData(luad_data))
suppressMessages({
library(edgeR)
library(limma)
library(Glimma)
library(gplots)
library(org.Mm.eg.db)
library(RColorBrewer)
library(TCGAbiolinks)
library(SummarizedExperiment)
})
# Alternativamente para quando o servidor está em baixo
luad_data = load('luad_data_load.rda')
# Alternativamente para quando o servidor está em baixo
luad_data = load('luad_data_load.rda')
luad_data = data
# Tamanho do objeto
dim(luad_data)
# Informação sobre o estudo
metadata(luad_data)
# Informação sobre os tipos de dados de RNASeq
names(assays(luad_data))
# Tipos de metadados associados a cada gene
names(rowData(luad_data))
# Tipos de metadados associados a cada amostra
names(colData(luad_data))
# Carregamento, extração e transformação dos dados provenientes do RNAseq
seqdata = as.data.frame(assay(luad_data, 'unstranded'))
#Verificação da inexistência de valores NA
any(is.na(seqdata))
# Carregamento de metadados
gender = luad_data$gender
sample_id = substr(luad_data$sample_id, 1, 10)
expr = luad_data$paper_expression_subtype
meta = data.frame(sample_id = sample_id, gender = gender, expr = expr)
# Substituir caracteres especiais nos valores de expr
meta$expr <- gsub("prox.-prolif.", "prox_prolif", meta$expr)
meta$expr <- gsub("prox.-inflam", "prox_inflam", meta$expr)
View(meta)
# Limpeza dos dados e tratamento relativo ao género
any(is.na(meta$gender))
# Converte 'gender' para factor com dois níveis
meta$gender = factor(meta$gender, levels = c("male", "female"))
table(meta$gender)
filter = meta$gender != '[Not Available]'
meta = meta[filter,]
any(is.na(meta$expr))
meta = meta[!is.na(meta$expr),]
table(meta$expr)
filter = meta$expr != '[Not Available]'
meta = meta[filter,]
# Criar uma vista dos dados de RNASeq com base nos subtipos de expressão
seqdata_filter = seqdata[,meta$expr]
View(meta)
# Limpeza dos dados e tratamento relativo ao género
any(is.na(meta$gender))
# Converte 'gender' para factor com dois níveis
#meta$gender = factor(meta$gender, levels = c("male", "female"))
table(meta$gender)
filter = meta$gender != '[Not Available]'
meta = meta[filter,]
any(is.na(meta$expr))
meta = meta[!is.na(meta$expr),]
table(meta$expr)
filter = meta$expr != '[Not Available]'
meta = meta[filter,]
# Criar uma vista dos dados de RNASeq com base nos subtipos de expressão
seqdata_filter = seqdata[,meta$expr]
# Carregamento de metadados
gender = luad_data$gender
sample_id = substr(luad_data$sample_id, 1, 10)
expr = luad_data$paper_expression_subtype
meta = data.frame(sample_id = sample_id, gender = gender, expr = expr)
# Limpeza dos dados e tratamento relativo ao género
any(is.na(meta$gender))
# Converte 'gender' para factor com dois níveis
#meta$gender = factor(meta$gender, levels = c("male", "female"))
table(meta$gender)
filter = meta$gender != '[Not Available]'
meta = meta[filter,]
any(is.na(meta$expr))
meta = meta[!is.na(meta$expr),]
table(meta$expr)
filter = meta$expr != '[Not Available]'
meta = meta[filter,]
# Criar uma vista dos dados de RNASeq com base nos subtipos de expressão
seqdata_filter = seqdata[,meta$expr]
# Garantir que as dims estão corretas
dim(seqdata_filter)
dim(meta)
# Corrigir nomes e garantir ordem
colnames(seqdata_filter) = meta$sample_id
all(names(seqdata_filter) == meta$sample_id)
# Calculamos CPM
calccpm = cpm(seqdata_filter)
# Aparamos os dados, removendo genes com baixa expressão
# é geralmente aceite a eliminação de genes com CPM inferior a 0.5 em mais do que 2 amostras
thresh = calccpm > 0.5
keep = rowSums(thresh) >= 2
counts_keep = seqdata_filter[keep,]
summary(keep)
dim(counts_keep)
# Criação do objeto para a análise de expr. diferencial
dgeObj = DGEList(counts_keep)
names(dgeObj)
head(dgeObj$samples)
## distributions - log transform
logcounts = cpm(dgeObj,log=TRUE)
boxplot(logcounts[,1:50], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,51:100], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,101:150], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,151:200], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
boxplot(logcounts[,201:248], xlab="", ylab="Log2 counts per million",las=2)
abline(h=median(logcounts),col="blue")
title("Boxplots of logCPMs (unnormalised)")
# Cálculo da variância de cada gene nos dados de contagem logaritmizada
var_genes = apply(logcounts, 1, var)
# Seleção dos 10 genes com maior variabilidade
select_var = names(sort(var_genes, decreasing=TRUE))[1:10]
head(select_var)
# Seleciona as linhas da matriz 'logcounts' com base nos índices fornecidos em 'select_var'
highly_variable_lcpm = logcounts[select_var,]
# Calcula as dimensões (número de linhas e colunas) da matriz 'highly_variable_lcpm'
dim(highly_variable_lcpm)
mypalette <- brewer.pal(9,"RdYlBu")
morecols <- colorRampPalette(mypalette)
#indices = 1:242
#unique_stages = unique(meta$oncogene[indices])
#cores = length(unique_stages)
#stage_pal = brewer.pal(9,'Set1')
#stage_cols = colorRampPalette(stage_pal)
#col.cell = stage_cols(length(unique_stages))
#col.cell <- stage_cols(cores)[meta$oncogene[indices]]
#col.cell = c("purple","orange", "green")[meta$expr]
#color_mapping <- setNames(col.cell, unique_stages)
#heatmap.2(highly_variable_lcpm[,indices],
#          col=rev(morecols(5)),
#          trace="column",
#          main="Top 10 most variable genes across samples",
#          ColSideColors = col.cell,
#          scale="row"
#          )
#heatmap.2(highly_variable_lcpm,
#          col=rev(morecols(50)),
#          trace="column",
#          main="Top 10 most variable genes across samples",
#          ColSideColors=col.cell,scale="row")
col.cell1 = c("purple","orange", "green")[meta$expr]
heatmap.2(highly_variable_lcpm,
col=rev(morecols(50)),
trace="column",
main="Top 10 most variable genes across samples",
ColSideColors=col.cell1,scale="row")
dgeObj = calcNormFactors(dgeObj)
# demo
plotMD(logcounts, column = 7)
abline(h=0,col="grey")
plotMD(dgeObj, column = 7)
abline(h=0,col="grey")
# Substituir caracteres especiais nos valores de expr
meta$expr <- gsub("prox.-prolif.", "prox_prolif", meta$expr)
meta$expr <- gsub("prox.-inflam", "prox_inflam", meta$expr)
group = paste(meta$gender, meta$expr, sep = ".")
group = as.character(group)
group
gender = sapply(strsplit(group, ".", fixed=T), function(x) x[1])
gender = factor(gender, levels = c("male", "female"))
expr = sapply(strsplit(group, ".", fixed=T), function(x) x[2])
expr = factor(expr, levels = c("prox_prolif", "prox_inflam", "TRU"))
# Definir a variável de design
design = model.matrix(~ expr + gender)
head(design)
dgeObj = estimateCommonDisp(dgeObj)
dgeObj$common.dispersion
dgeObj = estimateGLMTrendedDisp(dgeObj)
dgeObj = estimateTagwiseDisp(dgeObj)
plotBCV(dgeObj)
fit = glmFit(dgeObj, design)
head(fit$coefficients)
lrt.BvsL = glmLRT(fit, coef = 2)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
lrt.BvsL = glmLRT(fit, coef = 3)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
lrt.BvsL = glmLRT(fit, coef = 4)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam-exprTRU, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
print(colnames(design))
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
# get annotation for genes in results
ann <- select(org.Mm.eg.db,keys=rownames(results),columns=c("ENTREZID","SYMBOL","GENENAME"))
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
# get annotation for genes in results
#ann <- select(org.Mm.eg.db,keys=rownames(results),columns=c("ENTREZID","SYMBOL","GENENAME"))
#head(ann)
#results.annotated <- cbind(results, ann)
#head(results.annotated)
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam-genderfemale, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam-genderfemale, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
fit = glmFit(dgeObj, design)
head(fit$coefficients)
lrt.BvsL = glmLRT(fit, coef = 2)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam-exprTRU, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
# Definir contraste
PvsV <- makeContrasts(exprprox_inflam, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
# Definir contraste
PvsV <- makeContrasts(genderfemale, levels = design)
lrt.pVsV <- glmLRT(fit, contrast=PvsV)
topTags(lrt.pVsV)
lrt.BvsL = glmLRT(fit, coef = 2)
topTags(lrt.BvsL)
results <- as.data.frame(topTags(lrt.BvsL,n = Inf))
results
dim(results)
summary(de <- decideTestsDGE(lrt.BvsL))
detags <- rownames(dgeObj)[as.logical(de)]
plotSmear(lrt.BvsL, de.tags=detags)
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
signif <- -log10(results$FDR)
plot(results$logFC,signif,pch=16)
points(results[detags,"logFC"],-log10(results[detags,"FDR"]),pch=16,col="red")
# get annotation for genes in results
#ann <- select(org.Mm.eg.db,keys=rownames(results),columns=c("ENTREZID","SYMBOL","GENENAME"))
#head(ann)
#results.annotated <- cbind(results, ann)
#head(results.annotated)
# get annotation for genes in results
#ann <- select(org.Mm.eg.db,keys=rownames(results),columns=c("ENTREZID","SYMBOL","GENENAME"))
#head(ann)
#results.annotated <- cbind(results, ann)
#head(results.annotated)
# get annotation for genes in results
ann <- select(org.Mm.eg.db,keys=rownames(results),columns=c("ENTREZID","SYMBOL","GENENAME"))
library(org.Mm.eg.db)
# Obtenha os identificadores Entrez de 'results'
entrez_ids <- rownames(results)
# Selecione as informações de anotação desejadas
ann <- select(org.Mm.eg.db, keys=entrez_ids, columns=c("ENTREZID","SYMBOL","GENENAME"))
rownames(results)
library(org.Mm.eg.db)
# Obtenha os identificadores Entrez de 'results'
entrez_ids <- rownames(results)
# Selecione as informações de anotação desejadas
ann <- select(org.Mm.eg.db, keys=entrez_ids, columns=c("ENTREZID","SYMBOL","GENENAME"))
library(biomaRt)
# Carregar o conjunto de dados correspondente
ensembl <- useMart("ensembl", dataset = "mmusculus_gene_ensembl")
# Converter ENSG IDs para Entrez IDs
conversion <- getBM(attributes = c("ensembl_gene_id", "entrezgene"),
filters = "ensembl_gene_id",
values = entrez_ids,
mart = ensembl)
# Carregar o conjunto de dados correspondente
ensembl <- useMart("ensembl", dataset = "mmusculus_gene_ensembl")
# Obter os símbolos de gene (gene symbols)
gene_symbols <- getBM(attributes = c("ensembl_gene_id", "external_gene_name"),
filters = "ensembl_gene_id",
values = entrez_ids,
mart = ensembl)
# Converter os símbolos de gene em Entrez IDs
conversion <- getBM(attributes = c("entrezgene"),
filters = "external_gene_name",
values = gene_symbols$external_gene_name,
mart = ensembl)
